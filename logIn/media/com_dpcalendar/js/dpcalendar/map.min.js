DPCalendar=window.DPCalendar||{},function(e){"use strict";document.addEventListener("DOMContentLoaded",function(){for(var o=document.querySelectorAll(".dpcalendar-map"),t=0;t<o.length;t++)e.Map.create(o[t])}),e.Map={},e.Map.create=function(o){if("undefined"!=typeof google){var t=o.dataset,a=google.maps.MapTypeId.ROADMAP;switch(t.type){case 2:a=google.maps.MapTypeId.SATELLITE;break;case 3:a=google.maps.MapTypeId.HYBRID;break;case 4:a=google.maps.MapTypeId.TERRAIN}var n=new google.maps.Map(o,{zoom:parseInt(t.zoom?t.zoom:4),mapTypeId:a,center:new google.maps.LatLng(t.latitude?t.latitude:47,t.longitude?t.longitude:4),draggable:document.body.clientWidth>480,scrollwheel:document.body.clientWidth>480});n.dpBounds=new google.maps.LatLngBounds,n.dpMarkers=[],n.dpElement=o,o.dpmap=n;var r=o.closest(".dpcalendar-locations-container");if(null==r)return n;for(var l=r.querySelectorAll(".location-details"),d=0;d<l.length;d++){var i=l[d],s=i.dataset,c=i.parentElement.querySelector(".location-description");!s.description&&c&&(s.description=c.innerHTML),e.Map.createMarker(n,s)}return n}},e.Map.createMarker=function(e,o){var t=o.latitude,a=o.longitude;if(null!=t&&""!=t){var n="http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|";"https:"==document.location.protocol&&(n="https://chart.googleapis.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|");var r=new google.maps.LatLng(t,a),l={position:r,map:e,title:o.title},d=o.color;d&&(l.icon={url:n+String(d).replace("#",""),size:new google.maps.Size(21,34),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(10,34)});var i=new google.maps.Marker(l),s=o.description?o.description:o.title;if(s){var c=new google.maps.InfoWindow({content:s});google.maps.event.addListener(i,"click",function(){c.open(e,i)})}return e.dpMarkers.push(i),e.dpBounds.extend(r),e.setCenter(e.dpBounds.getCenter()),i}},e.Map.clearMarkers=function(e){if(null!=e&&null!=e.dpMarkers){for(var o=0;o<e.dpMarkers.length;o++)e.dpMarkers[o].setMap(null);e.dpMarkers=[],e.dpBounds=new google.maps.LatLngBounds;var t=e.dpElement.dataset;e.setCenter(new google.maps.LatLng(t.latitude?t.latitude:47,t.longitude?t.longitude:4))}},e.Map.currentLocation=function(e){return!!navigator.geolocation&&(navigator.geolocation.getCurrentPosition(function(o){var t="location.loc";-1==window.location.href.indexOf("administrator")&&(t="locationform.loc"),Joomla.request({url:"index.php?option=com_dpcalendar&task="+t+"&loc="+encodeURIComponent(o.coords.latitude+","+o.coords.longitude),method:"GET",onSuccess:function(o){var t=JSON.parse(o);null!=t.messages&&document.getElementById("system-message-container")&&Joomla.renderMessages(t.messages),e(t.data.formated)}})},function(e){Joomla.renderMessages({error:[e.message]})}),!0)}}(DPCalendar);