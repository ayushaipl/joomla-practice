document.addEventListener("DOMContentLoaded",function(){for(var e=function(e){DPCalendar.loader("hide",e),Joomla.request({method:"POST",url:"index.php?option=com_dpcalendar&view=map&layout=events&format=raw",data:DPCalendar.formToString(e.querySelector("form")),onSuccess:function(a){DPCalendar.loader("hide",e);var t=JSON.parse(a),r=e.querySelector(".dpcalendar-fixed-map");if(null!=r&&null!=r.dpmap){DPCalendar.Map.clearMarkers(r.dpmap);for(var n=0;n<t.data.length;n++){var o=t.data[n];if(null!==o&&"object"==typeof o)for(var l=0;l<o.location.length;l++){var c=JSON.parse(JSON.stringify(o.location[l]));c.title=o.title,c.color=o.color,c.description=o.description,DPCalendar.Map.createMarker(r.dpmap,c)}}null!=t.messages&&document.getElementById("system-message-container")&&Joomla.renderMessages(t.messages)}},onError:function(a){DPCalendar.loader("hide",e);var t=JSON.parse(a);null!=t.messages&&document.getElementById("system-message-container")&&Joomla.renderMessages(t.messages)}})},a=document.querySelectorAll(".dpcalendar-map-container"),t=0;t<a.length;t++){for(var r=a[t].querySelectorAll("input, select"),n=0;n<r.length;n++)r[n].onchange=function(a){e(this.closest(".dpcalendar-map-container"))};var o;a[t].addEventListener("click",function(e){if(!e.target||!e.target.matches("a.dp-event-link"))return!0;if(window.innerWidth<600)return!0;e.preventDefault();var a=this.closest(".dpcalendar-map-container");if(1==a.dataset.popup){var t=new Url(e.target.getAttribute("href"));t.query.tmpl="component",DPCalendar.modal(t,a.dataset.popupwidth,a.dataset.popupheight)}else window.location=DPCalendar.encode(e.target.getAttribute("href"));return!1}),DPCalendar.loader("hide",a[t]),e(a[t]),(o=a[t].querySelector(".dp-map-search"))&&(o.onclick=function(a){return a.preventDefault(),e(this.closest(".dpcalendar-map-container")),!1}),(o=a[t].querySelector(".dp-map-cancel"))&&(o.onclick=function(a){a.preventDefault();var r=this.parentElement.parentElement,n=r.querySelectorAll("div>input");for(t=0;t<n.length;t++)n[t].value="";return r.querySelector("[name=radius]").value=20,e(this.closest(".dpcalendar-map-container")),!1}),(o=a[t].querySelector(".dp-map-current-location"))&&(o.onclick=function(a){return a.preventDefault(),DPCalendar.Map.currentLocation(function(t){var r=a.target.closest(".dpcalendar-map-container");r.querySelector("[name=location]").value=t,e(r)}),!1}),!1 in navigator&&(a[t].querySelector(".dp-map-location").style.display="none")}});